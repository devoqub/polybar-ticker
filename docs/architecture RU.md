ChatGPT Generated

1. Общее описание

Этот проект представляет собой приложение для вывода криптовалютных котировок на панель Polybar с возможностью
интерактивного управления через сервер команд. Он использует асинхронный подход с использованием asyncio, а также
несколько вспомогательных модулей для работы с процессами и веб-сокетами.

2. Структура проекта
   2.1 actions.py

Файл содержит класс CommandServer, который управляет взаимодействием с пользователем через сервер команд. Он слушает
команды от пользователя и передает их в менеджер соединений для выполнения действий. В частности, поддерживаются
команды:

    next — переключение на следующее соединение.
    prev — переключение на предыдущее соединение.
    change-handler — смена обработчика сообщений для вывода информации.

Ключевые компоненты:

    CommandServer: Основной сервер для получения команд.
    handle_client(): Обрабатывает команду от клиента и выполняет действия в зависимости от команды.
    start(): Запускает сервер на заданном хосте и порту.

2.2 utils.py

Файл содержит утилитарные функции для работы с процессами и файлами, включая управление PID-файлами и убивание процессов
по порту.
Ключевые компоненты:

    kill_pid_from_file(): Завершается процесс по PID, сохраненному в файле.
    create_pid_file(): Создает и блокирует файл с PID текущего процесса.
    kill_process_by_port(): Убивает процесс, который использует указанный порт.

2.3 message_handlers.py

Файл содержит абстрактные классы и конкретные реализации для обработки сообщений от серверов. Обработчики сообщений
предоставляют различные форматы вывода для криптовалютных котировок.
Ключевые компоненты:

    MessageHandler: Абстрактный класс для всех обработчиков сообщений.
    DefaultMessageHandler: Обработчик для отображения цены криптовалюты в стандартном формате.
    CompactMessageHandler: Обработчик для отображения только цены криптовалюты.
    DisplayAllTickersMessageHandler: Обработчик для отображения всех котировок.
    HiddenMessageHandler: Обработчик для скрытого вывода.

2.4 main.py

Основной файл, который инициирует весь процесс: устанавливает соединения, запускает сервер команд и процесс отображения.
Он также управляет аргументами командной строки с помощью argparse.
Ключевые компоненты:

    init_parser(): Настроивает аргументы командной строки.
    main(): Основная асинхронная функция, которая инициирует все процессы:
        Создание списка соединений через WSConnection для каждого тикера.
        Создание и запуск менеджера соединений.
        Запуск сервера команд через CommandServer.
        Отображение анимации приветствия.
    greeting(): Анимация приветствия, которая повторяет блеск сэмпла для веселого начала.

2.5 config.py

Конфигурационный файл для задания настроек приложения, включая список тикеров с URL-соединениями для каждого из них,
параметры для управления процессами и настройки серверов.

3. Процесс работы

   Инициализация: При запуске основного файла main.py инициализируются параметры из config.py, создаются необходимые
   соединения для отслеживания котировок криптовалют.

   Подключение к WebSocket-серверам: Через объект ConnectionManager устанавливаются WebSocket-соединения для каждого
   тикера. Эти соединения обеспечивают получение данных о текущей стоимости криптовалюты в реальном времени.

   Обработка сообщений: В зависимости от типа обработчика (например, стандартный, компактный или все тикеры) сообщения
   от сервера обрабатываются с помощью одного из классов, наследующих MessageHandler.

   Управление с помощью команд: Когда пользователь взаимодействует с Polybar (например, кликает на тикер), командный
   сервер (CommandServer) получает команду и передает ее в ConnectionManager, который выполняет соответствующее
   действие, такое как переключение соединений или смена обработчика сообщений.

   Запуск серверов: Асинхронно запускаются три процесса:
   Отображение анимации приветствия.
   Запуск всех соединений через ConnectionManager.
   Запуск сервера команд через CommandServer.

   Завершение работы: При завершении работы удаляется PID-файл и убиваются процессы, использующие указанный порт, чтобы
   предотвратить конфликты при последующих запусках.

4. Архитектурные решения

   Асинхронная модель: Использование asyncio позволяет эффективно управлять множественными соединениями и выполняемыми
   задачами, минимизируя блокировки.

   Модульность: Проект разделен на отдельные модули с четкой ответственностью:
   actions.py: Управление командами и сервером.
   utils.py: Утилитарные функции для работы с процессами и PID-файлами.
   message_handlers.py: Разделение обработчиков сообщений для разных форматов.
   main.py: Основная логика запуска и взаимодействия между компонентами.

   Поддержка многозадачности: Приложение настроено на асинхронное выполнение всех задач, включая установку соединений и
   обработку команд от пользователей.

   Гибкость: Через config.py легко добавить новые тикеры или изменить параметры конфигурации без вмешательства в
   основной код.

5. Будущие улучшения

   Рефакторинг CommandServer: Упрощение кода для обработки команд и улучшение тестируемости.
   Дополнение функционала: Добавление новых типов обработчиков сообщений для еще большей кастомизации.
   Модификация UI: Возможность использования графического интерфейса для отображения данных (сейчас проект ориентирован
   на Polybar).